---
title: "Exploratory Analysis and Visualizations"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
    code_folding: hide
---

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(leaflet)
library(plotly)
```

## Dynamic histogram 

```{r}
df_histo_pm2.5 = 
  read_csv("data/cleaned_data/air_quality_zips.csv") |> 
  mutate(zip = as.factor(zip)) |>
  filter(str_detect(time_period, "Annual Average")) |> 
  mutate(year = str_extract(time_period, "\\d{4}")) |> 
  filter(name == "Fine particles (PM 2.5)") |> 
  select(year, data_value)
```

```{r}
df_histo_pm2.5 = df_histo_pm2.5 |> 
  mutate(year = as.character(year))

fig = plot_ly(alpha = 0.6)

for(year_value in unique(df_histo_pm2.5$year)) {
  year_data = filter(df_histo_pm2.5, year == year_value)
  fig = fig |> 
    add_histogram(x = year_data$data_value, 
                  name = year_value,
                  marker = list(opacity = 0.6))
}

fig
```

